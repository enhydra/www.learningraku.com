<!--

{
  "author" => "brian",
  "categories" => "examples",
  "config" => {
    "base_dir" => "docs",
    "cname" => "test.learningraku.com",
    "default_test" => "abc",
    "items_json" => "docs/items.json",
    "last" => undef,
    "recent_items" => 5,
    "site_title" => "Learning Perl 6 (Raku)",
    "template" => "default",
    "template_dir" => "_templates"
  },
  "date" => "2016-02-28 05:26:36",
  "file" => "_posts/2016-02-28-dos-pattern-matching-in-perl-6.html",
  "link" => "http://www.learningraku.com/2016/02/28/dos-pattern-matching-in-perl-6/",
  "local_path" => "docs/2016/02/28/dos-pattern-matching-in-perl-6/index.html",
  "post_epoch" => 1456637196,
  "post_id" => 57,
  "post_name" => "dos-pattern-matching-in-perl-6",
  "processing_datestr" => "Sat Apr  3 10:14:03 2021",
  "processing_epoch" => 1617459243,
  "status" => "publish",
  "tags" => "",
  "title" => "DOS pattern matching, in Perl 6",
  "type" => "post",
  "web_path" => bless( {
    "path" => "/2016/02/28/dos-pattern-matching-in-perl-6/"
  }, 'Mojo::Path' )
}

-->

<html>

<head>
	<base href="https://test.learningraku.com/">
<title>DOS pattern matching, in Perl 6</title>
	<link rel="stylesheet" href="/style.css">
	<meta name="generator" content="brian's site generator" />
	<meta charset="UTF-8" />
</head>

<!--

This is the the page template

{
  "author" => "brian",
  "categories" => "examples",
  "config" => {
    "base_dir" => "docs",
    "cname" => "test.learningraku.com",
    "default_test" => "abc",
    "items_json" => "docs/items.json",
    "last" => undef,
    "recent_items" => 5,
    "site_title" => "Learning Perl 6 (Raku)",
    "template" => "default",
    "template_dir" => "_templates"
  },
  "date" => "2016-02-28 05:26:36",
  "file" => "_posts/2016-02-28-dos-pattern-matching-in-perl-6.html",
  "link" => "http://www.learningraku.com/2016/02/28/dos-pattern-matching-in-perl-6/",
  "local_path" => "docs/2016/02/28/dos-pattern-matching-in-perl-6/index.html",
  "post_epoch" => 1456637196,
  "post_id" => 57,
  "post_name" => "dos-pattern-matching-in-perl-6",
  "processing_datestr" => "Sat Apr  3 10:14:03 2021",
  "processing_epoch" => 1617459243,
  "status" => "publish",
  "tags" => "",
  "title" => "DOS pattern matching, in Perl 6",
  "type" => "post",
  "web_path" => bless( {
    "path" => "/2016/02/28/dos-pattern-matching-in-perl-6/"
  }, 'Mojo::Path' )
}

-->

<html>

<head>
	<base href="https://test.learningraku.com/">
<title>DOS pattern matching, in Perl 6</title>
	<link rel="stylesheet" href="/style.css">
	<meta name="generator" content="brian's site generator" />
	<meta charset="UTF-8" />
</head>

<body>
<div id="page">

<div id="top">
<A href="/index/">Home</a> •
<A href="/about/">About</a> •
<a href="/book/">Book</a> •
<a href="/downloads/">Downloads</a>
</div>  <!-- top -->

<div id="middle">

<div id="sidebar">
<img id="small_cover" src="images/cover.png" width="180" height="236" />

<div id="sponsors">
<p>Github sponsors</p>
</div>

<h2 class="sidebar">Links</h2>

<div class="textwidget"><p><a href="https://www.oreilly.com/catalog/errata.csp?isbn=0636920062776">Book errata</a><br />
<a href="https://goo.gl/EbA7gF">Google Books preview</a><br />
<a href="http://shop.oreilly.com/product/0636920062776.do">O&#8217;Reilly Media listing</a></p>
<hr />
<p><i>Many resources have not changed the name from Perl 6 to Raku, so these resources may use either.</i></p>
<p><a href="https://design.raku.org">Raku Design Docs (dated)</a><br />
<a href="http://docs.raku.org">Raku Docs</a><br />
<a href="https://learnxinyminutes.com/docs/raku/">Learn Raku in Y Minutes</a><br />
<a href="https://modules.raku.org">Raku modules</a><br />
<a href="https://rosettacode.org/wiki/Category:Raku">Rosetta Code examples</a><br />
<a href="http://examples.perl6.org/categories/euler.html">Project Euler examples</a><br />
<a href="http://examples.perl6.org">Perl 6 Examples</a><br />
<a href="https://github.com/Raku/roast">Raku Roast (test suite examples)</a></p>
</div>

</div> <!-- sidebar -->

<div id="content">

I rewrote my <a href="http://www.learning-perl.com/2016/02/dos-pattern-matching-in-perl/">DOS pattern matching</a> in Perl 6. There's nothing particularly fancy here and I tried to keep it close to the version I wrote in Perl 5 and <a href="https://blogs.msdn.microsoft.com/oldnewthing/20071217-00/?p=24143">the way Raymond Chen presented it</a>. <!--more-->

<pre class="brush:plain">
#!perl6

=begin pod

Match 8.3 filenames in the DOS way, from Raymond Chen

https://blogs.msdn.microsoft.com/oldnewthing/20071217-00/?p=24143

1. Start with eleven spaces and the cursor at position 1.

2. Read a character from the input. If the end of the input is
reached, then stop.

3. If the next character in the input is a dot, then set positions 9,
10, and 11 to spaces, move the cursor to position 9, and go back to
step 2.

4. If the next character in the input is an asterisk, then fill the
rest of the pattern with question marks, move the cursor to position
12, and go back to step 2. (Yes, this is past the end of the pattern.)

5. If the cursor is not at position 12, copy the input character to
the cursor position and advance the cursor.

*: Remember that Perl 6 counts strings counting from zero.

=end pod

for $=finish.lines -> $line {
	my $dos_pattern = ' ' x 11;
	my $cursor = 0;

	for $line.split("", :skip-empty) -> $char {
		if $char eq '.' {
			$dos_pattern.substr-rw( 8, 3 ) = ' ' x 3;
			$cursor = 8;
			}
		elsif $char eq '*' {
			$dos_pattern.substr-rw( $_, 1 ) = '?' for $cursor .. 10;
			$cursor = 11;
			}
		elsif $cursor != 11 {
			$dos_pattern.substr-rw( $cursor++, 1 ) = $char;
			}

		}

	printf "%d: %12s -> %12s\n", $++, $line, $dos_pattern;
	}

=finish
ABCD.TXT
ABCDEFGHIJK
A*B.TXT
*.*
*
*.TXT
.TXT
</pre>

I get the same output.

<pre class="brush:plain">
0:     ABCD.TXT ->  ABCD    TXT
1:  ABCDEFGHIJK ->  ABCDEFGHIJK
2:      A*B.TXT ->  A???????TXT
3:          *.* ->  ???????????
4:            * ->  ???????????
5:        *.TXT ->  ????????TXT
6:         .TXT ->          TXT
</pre>

But let's look at some differences.

I have <code>$line.split("", :skip-empty)</code>. Splitting with an empty string creates empty elements at the beginning <i>and</i> end of the list, so I can add the <code>:skip-empty</code>. 

There's a <a href="https://doc.perl6.org/type/Str#routine_chars"><code>chars</code></a> method in the <code>Str</code> class, but it doesn't return characters. It returns a count. The <a href="https://doc.perl6.org/type/Str#routine_lines"><code>lines</code></a> method, however, returns lines and not a count.

The <a href="https://doc.perl6.org/type/Str"><code>Str</code> class</a> has several <code>subst*</code> methods that do slightly different things. The <code>subset-rw</code> provides the lvalue that I can assign to. 

And, check out that anonymous variable in the <code>printf</code> line. Perl 6 has a feature that creates persistent state variables that are private to a statement. Don't give the variable a name. <code>$++</code> is a variable without a name that I post-increment. That's pretty handy.


</div> <!-- content -->

</div> <!-- middle -->

<div id="bottom">
This is the bottom stuff
</div> <!-- bottom -->

</div> <!-- page_div -->
</body>

</html>

</html>

