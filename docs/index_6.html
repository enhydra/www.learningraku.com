<!--
title: Index 6
link: http://www.learningraku.com/index_6.html
author: brian
date: 2023-03-02 1:50:44
post_name: main 6
status: publish
type: list
categories:
tags:
-->

<html>

<head>
	<base href="https://test.learningraku.com/">
	<title>Index 6</title>
	<link rel="stylesheet" href="/style.css">
	<meta name="generator" content="brian's site generator" />
	<meta charset="UTF-8" />
</head>


<!-- start middle_main_page -->
<div id="middle">

<!-- start sidebar -->
<div id="sidebar">
	<img id="small_cover" src="images/cover.png" width="180" height="236" />

	<div id="sponsors">
		<iframe src="https://github.com/sponsors/briandfoy/button" title="Sponsor briandfoy" height="35" width="116" style="border: 0;"></iframe>
	</div>

	<div class="textwidget"><p><a href="https://www.oreilly.com/catalog/errata.csp?isbn=0636920062776">Book errata</a><br />
		<a href="https://goo.gl/EbA7gF">Google Books preview</a><br />
		<a href="http://shop.oreilly.com/product/0636920062776.do">O&#8217;Reilly Media listing</a><br />
		<a href="https://amzn.to/3E0JQxK">Amazon.com</a></p>
		<hr />
		<p><i>Many resources have not changed the name from Perl 6 to Raku, so these resources may use either.</i></p>
		<p><a href="https://design.raku.org">Raku Design Docs (dated)</a><br />
		<a href="http://docs.raku.org">Raku Docs</a><br />
		<a href="https://learnxinyminutes.com/docs/raku/">Learn Raku in Y Minutes</a><br />
		<a href="https://modules.raku.org">Raku modules</a><br />
		<a href="https://rosettacode.org/wiki/Category:Raku">Rosetta Code examples</a><br />
		<a href="http://examples.perl6.org/categories/euler.html">Project Euler examples</a><br />
		<a href="http://examples.perl6.org">Perl 6 Examples</a><br />
		<a href="https://github.com/Raku/roast">Raku Roast (test suite examples)</a></p>
	</div>
</div>
<!-- end sidebar -->

<!-- start excerpt_list -->
<div id="content">


    <!-- ----------------------------------------------------------- -->
	<div class="post">
		<h2 class="post_title excerpt_page"><a href="/2017/05/21/dont-use-in-programming/">Don't use < in programming</a></h2>
		<div class="byline">
		<span class="author">brian</span> • <span class="date">May 21, 2017</span>
</div>

		<div class="excerpt">





I don&#39;t actually mean that you shouldn&#39;t use <code>&lt;</code>, but I&#39;m playing off <a href="http://llewellynfalco.blogspot.hu/2016/02/dont-use-greater-than-sign-in.html">Don&#39;t use the greater than sign in programming</a>. That post from Lewellyn Falco reminded me of a trick for a conditional that checks if a number is inside or outside of a range. A C programmer pointed this out to me years and years ago. It&#39;s not an uncommon trick, but it&#39;s not one I think about much. And, in Perl 6, there&#39;s another way to do the same thing.

<!--more-->

To convey intent, he constructed his comparisons so both uses of the variable were either on the inside or on the outside. That way, the position of the variable in the comparisons showed where he intended its value to be. Here&#39;s that expressed in C:
<pre class="brush:c">/* x between 5 and 10 */
if( 5 &lt; x &amp;&amp; x &lt; 10 ) { ... }

/* x not between 5 and 10 */
if( x &lt;= 5 &amp;&amp; 10 &lt;= x ) { ... }
</pre>
The lowest value is left-most and the greatest value is right-most. Those might be literals or variables. For this to work, the comparators have to be the same. Flip one of them and it might never work because the combined conditions don&#39;t mean what they superficially appear to mean:
<pre class="brush:c">if( 5 &lt; x &amp;&amp; 10 &lt; x ) { ... }  /* Just x &gt; 10 really */
</pre>
Even with this trick of placing the variable in the literal code, thi still annoys me because I have to specify the variable twice.

Python 2 lets you do it with a <i>chained comparison</i>:
<pre class="brush:python">#!/usr/bin/python

x = 6

if 5 &lt; x &lt; 10 :
	print &quot;It&#39;s between 5 and 10&quot;
else:
	print &quot;It&#39;s outside the range&quot;
</pre>
Python didn&#39;t invent this feature. <a href="http://rigaux.org/language-study/concepts-history.html">Various resources that credit BCPL curiously link to a Perl 6 RFC</a>. Odd. I think they are all pulling from the same source. You can do it in Ruby if you <a href="https://gist.github.com/padde/2429814">redefine some operators</a>. CoffeeScript has it. Other languages have it.

But, this is a blog about Perl 6, which can do this too. This is one of the more pleasing small changes that I really like:
<pre class="brush:plain">my $x = 6;

if 5 &lt; $x &lt; 10 {
	put &quot;x is between 5 and 10&quot;;
	}
else {
	put &quot;x is not in range&quot;;
	}
</pre>
But, Perl 6 goes one better. If you want to test that something is within a range, test that it&#39;s in a <a href="https://docs.perl6.org/type/Range">Range</a>. To exclude the endpoints, you need the <code>^</code> characters around the <code>..</code>:
<pre class="brush:plain">if $x ~~ 5^..^10 {
	put &quot;x is between 5 and 10&quot;;
	}
else {
	put &quot;x is not in range&quot;;
	}
</pre>
This comparison really is the same thing. Instead of checking that <code>$x</code> is in the set <i>6,7,8,9</i> (as you might expect from turning the Range into a list) it tests that the value of <code>$x</code> as a <a href="https://docs.perl6.org/type/Real">Real</a> is between the endpoints. So, 5.5 and 9.999 are within that Range. That&#39;s the same behavior as the previous examples.

Perl 6 doesn&#39;t stop there. You can make the chain as long as you like:
<pre class="brush:plain">if 1 &lt; 2 &lt; 3 &lt; 4 &lt; 5 &lt; 6 &lt; 7 {
	say &quot;That&#39;s a long chain!&quot;;
	}
</pre>
But, you don&#39;t need the chain. The <a href="/2020/03/17/reducing-comparison-operators/">reduction operator works with the comparison operators too</a>:
<pre class="brush:plain">if [&lt;] 1, 2, 3, 4, 5, 6, 7 {
	say &quot;That&#39;s a not long chain!&quot;;
	}
</pre>



		</div> <!-- excerpt -->

		<span class="read_more"><a href="/2017/05/21/dont-use-in-programming/">Read more...</a></span>
</div> <!-- post -->



    <!-- ----------------------------------------------------------- -->
	<div class="post">
		<h2 class="post_title excerpt_page"><a href="/2017/05/01/rakudo-in-chocolatey-makes-appveyor-easier/">Rakudo in Chocolatey makes AppVeyor easier</a></h2>
		<div class="byline">
		<span class="author">brian</span> • <span class="date">May 01, 2017</span>
</div>

		<div class="excerpt">





Rakudo is now easier to install on Windows. <a href="https://chocolatey.org/packages/rakudostar">Rakudo Star is now in Chocolatey</a> (with 2017.04 awaiting moderation as I write this). This makes it much easier to automatically deploy Rakudo Star in Windows environments.

<div class="image center">
<div>
<img height="216" src="/images/chocolatey.png" width="500">
</div>
</div>

<!--more-->

Earlier this month I spent too much time getting <a href="/2017/04/02/rakudo-star-on-appveyor/">Rakudo to install on AppVeyor</a>, and, having spent too much time on that, I spent a bunch more getting co-maintainer permissions on the chocolatey package. I updated the original package created by Jake Russo back in 2015, including all the new chocolatey requirements. I have all of that in GitHub as <a href="https://github.com/briandfoy/rakudo-star-chocolatey">rakudo-star-chocolatey</a>. After the semi-manual approval process, I have a fresh Rakudo available. Two days later 2017.04 came out. I&#39;ve updated the package again and it&#39;s in moderation (should clear in a couple days).

Using a package manager that other services already support makes it a cinch to deploy Rakudo there. For example, Windows 10 has <a href="https://github.com/OneGet/oneget/blob/master/readme.md">OneGet</a>, a manager of package managers. You can install several package manager and ask OneGet to install something. Somehow it figures out who can provide it and does the magic:

<div class="image center">
<div>
<img height="369" src="/images/oneget-powershell.png" style="border:1" width="500">
</div>
</div>

That looks complicated, but it&#39;s really two commands with some confirmations:

<pre class="brush:plain">
PS C:\&gt; Get-PackageProvider -name chocolatey

PS C:\&gt; Install-Package rakudostar
</pre>

You probably have to answer a couple of questions in this process. The rakudostar package isn&#39;t trusted, but the chocolatey package has the SHA256 of the MSI from <a href="http://rakudo.org/">rakudo.org</a>. But, chocolatey also trusts me to use the right URL. I could put anything in there. I&#39;ll have to work on the trusted part some other time (unless you want to figure it out).

Now my AppVeyor config in the <a href="https://github.com/briandfoy/perl6_appveyor_test"> perl6_appveyor_test</a> test project is now much simpler. The Rakudo installation is a couple of lines instead of the tricky PowerShell I had before:

<pre class="plain">
  - if not exist &quot;C:\Rakudo&quot; cinst rakudostar
  - SET PATH=C:\rakudo\bin;C:\rakudo\share\perl6\site\bin;%PATH%
  - ps: refreshenv
  - perl6 -v
</pre>
 



		</div> <!-- excerpt -->

		<span class="read_more"><a href="/2017/05/01/rakudo-in-chocolatey-makes-appveyor-easier/">Read more...</a></span>
</div> <!-- post -->



    <!-- ----------------------------------------------------------- -->
	<div class="post">
		<h2 class="post_title excerpt_page"><a href="/2017/04/24/as-many-digits-as-you-like/">As many digits as you like</a></h2>
		<div class="byline">
		<span class="author">brian</span> • <span class="date">April 24, 2017</span>
</div>

		<div class="excerpt">





[mathjax]

I was playing with arbitrary precision rational numbers in Perl 6, irrationally perhaps by playing with the natural base, <i>e</i>, also known as Euler&#39;s Number. That&#39;s a builtin value in Perl 6 but with limited precision (that&#39;s probably good enough for most people): <!--more-->

<pre class="brush:plain">
$ perl6
&gt; e
2.71828182845905
</pre>

I want more digits so I calculate them myself. One approximation of <i>e</i> is an infinite series:

$$
e = \sum\limits_{n=0}^{\infty}\frac{1}{n!}
$$

I can turn that into Perl 6 as a program that specifies the number of digits past the decimal place I&#39;d like to calculate. In this code, you don&#39;t see a factorial explicitly. There&#39;s no need for a function (recursive or otherwise) because I can keep the result of the factorial in one iteration for the next:

<pre class="brush:plain">
sub MAIN ( Int $precision = 30 ) {
	loop {
		state $sum       = FatRat.new( 0, 1 );

		# the term in the sequence
		state $i         = 0;

		# The factorial, remembered for the next iteration
		state $last      = 1;

		$sum += FatRat.new( 1, $last );
		$last *= ++$i;

		put &quot;$i: ({$sum.nude})\n\t   &quot; ~ $sum;
		last if $sum.Str.chars &gt; $precision + 2; # +2 for the 2 and the .
		}
	}
</pre>

I use the <code>.nude</code> method to get the numerator and denominator of the fraction that Perl 6 tracks. I output that with the iteration number. Under that, I output part of the stringified version of the <a href="https://docs.perl6.org/type/FatRat">FatRat</a>:

<pre class="brush:plain">
$ perl6 euler.p6 20
1: (1 1)
	   1
2: (2 1)
	   2
3: (5 2)
	   2.5
4: (8 3)
	   2.666667
5: (65 24)
	   2.708333
6: (163 60)
	   2.716667
7: (1957 720)
	   2.718056
8: (685 252)
	   2.718254
9: (109601 40320)
	   2.718279
10: (98641 36288)
	   2.718282
11: (9864101 3628800)
	   2.71828180
12: (13563139 4989600)
	   2.71828183
13: (260412269 95800320)
	   2.718281828
14: (8463398743 3113510400)
	   2.71828182845
15: (47395032961 17435658240)
	   2.718281828458
16: (888656868019 326918592000)
	   2.7182818284590
17: (56874039553217 20922789888000)
	   2.718281828459042
18: (7437374403113 2736057139200)
	   2.71828182845905
19: (17403456103284421 6402373705728000)
	   2.71828182845904523
20: (82666416490601 30411275102208)
	   2.718281828459045
21: (6613313319248080001 2432902008176640000)
	   2.71828182845904523534
22: (69439789852104840011 25545471085854720000)
	   2.718281828459045235359
</pre>

Look at iterations 19 and 20. Each iteration should make the approximation larger because it only adds a positive value to the previous value. But, the value goes from 2.71828182845904523 to the slightly less 2.718281828459045. This isn&#39;t a rounding error because one is two digits shorter:

<pre class="brush:plain">
19: (17403456103284421 6402373705728000)
	   2.71828182845904523
20: (82666416490601 30411275102208)
	   2.718281828459045
</pre>

Notice what happened to the fraction in iteration 20. There are fewer digits in the denominator for that iteration. Perl 6 uses the number of digits in the denominator to decide how many digits to put into the stringification. You can see this in the <a href="https://github.com/rakudo/rakudo/blob/nom/src/core/Rational.pm">Rational.Str method in Rakudo</a>. It&#39;s a minimum of 6 digits, but otherwise one more than the number of denominator digits.

But, the fraction can change. Perl 6 normalizes that numerator and denominator to be co-prime. They share no common factors. This normalization is still the same number. If I make a <a href="https://docs.perl6.org/type/Rat">Rat</a> with 2 and 4, Perl 6 reduces that to 1 and 2:

<pre class="brush:plain">
$ perl6
To exit type &#39;exit&#39; or &#39;^D&#39;
&gt; Rat.new( 2, 4 )
0.5
&gt; Rat.new( 2, 4 ).nude
(1 2)
</pre>

When this happens in my Euler example, some iterations seem to backtrack in digits because of the digit length of the normalized fraction. No big whoop.

There&#39;s another way to write this program, though. Often we do these sorts of things because we pretend that we don&#39;t already know the answers. I could simply put the answer in the program and output the parts of it that I want. Maybe I don&#39;t need 10,000 digits but they are there if I want them:

<pre class="brush:plain">
#!/Applications/Rakudo/bin/perl6

# https://www.math.utah.edu/~pa/math/e.html
my $digits = q/
71828 18284 59045 23536 02874 71352 66249 77572 47093 69995 95749 66967 62772 40766 30353 54759 45713 82178 52516 64274 27466 39193 20030 59921 81741 35966 29043 57290 03342 95260 59563 07381 32328 62794 34907 63233 82988 07531 95251 01901 15738 34187 93070 21540 89149 93488 41675 09244 76146 06680 82264 80016 84774 11853 74234 54424 37107 53907 77449 92069 55170 27618 38606 26133 13845 83000 75204 49338 26560 29760 67371 13200 70932 87091 27443 74704 72306 96977 20931 01416 92836 81902 55151 08657 46377 21112 52389 78442 50569 53696 77078 54499 69967 94686 44549 05987 93163 68892 30098 79312 77361 78215 42499 92295 76351 48220 82698 95193 66803 31825 28869 39849 64651 05820 93923 98294 88793 32036 25094 43117 30123 81970 68416 14039 70198 37679 32068 32823 76464 80429 53118 02328 78250 98194 55815 30175 67173 61332 06981 12509 96181 88159 30416 90351 59888 85193 45807 27386 67385 89422 87922 84998 92086 80582 57492 79610 48419 84443 63463 24496 84875 60233 62482 70419 78623 20900 21609 90235 30436 99418 49146 31409 34317 38143 64054 62531 52096 18369 08887 07016 76839 64243 78140 59271 45635 49061 30310 72085 10383 75051 01157 47704 17189 86106 87396 96552 12671 54688 95703 50354 02123 40784 98193 34321 06817 01210 05627 88023 51930 33224 74501 58539 04730 41995 77770 93503 66041 69973 29725 08868 76966 40355 57071 62268 44716 25607 98826 51787 13419 51246 65201 03059 21236 67719 43252 78675 39855 89448 96970 96409 75459 18569 56380 23637 01621 12047 74272 28364 89613 42251 64450 78182 44235 29486 36372 14174 02388 93441 24796 35743 70263 75529 44483 37998 01612 54922 78509 25778 25620 92622 64832 62779 33386 56648 16277 25164 01910 59004 91644 99828 93150 56604 72580 27786 31864 15519 56532 44258 69829 46959 30801 91529 87211 72556 34754 63964 47910 14590 40905 86298 49679 12874 06870 50489 58586 71747 98546 67757 57320 56812 88459 20541 33405 39220 00113 78630 09455 60688 16674 00169 84205 58040 33637 95376 45203 04024 32256 61352 78369 51177 88386 38744 39662 53224 98506 54995 88623 42818 99707 73327 61717 83928 03494 65014 34558 89707 19425 86398 77275 47109 62953 74152 11151 36835 06275 26023 26484 72870 39207 64310 05958 41166 12054 52970 30236 47254 92966 69381 15137 32275 36450 98889 03136 02057 24817 65851 18063 03644 28123 14965 50704 75102 54465 01172 72115 55194 86685 08003 68532 28183 15219 60037 35625 27944 95158 28418 82947 87610 85263 98139 55990 06737 64829 22443 75287 18462 45780 36192 98197 13991 47564 48826 26039 03381 44182 32625 15097 48279 87779 96437 30899 70388 86778 22713 83605 77297 88241 25611 90717 66394 65070 63304 52795 46618 55096 66618 56647 09711 34447 40160 70462 62156 80717 48187 78443 71436 98821 85596 70959 10259 68620 02353 71858 87485 69652 20005 03117 34392 07321 13908 03293 63447 97273 55955 27734 90717 83793 42163 70120 50054 51326 38354 40001 86323 99149 07054 79778 05669 78533 58048 96690 62951 19432 47309 95876 55236 81285 90413 83241 16072 26029 98330 53537 08761 38939 63917 79574 54016 13722 36187 89365 26053 81558 41587 18692 55386 06164 77983 40254 35128 43961 29460 35291 33259 42794 90433 72990 85731 58029 09586 31382 68329 14771 16396 33709 24003 16894 58636 06064 58459 25126 99465 57248 39186 56420 97526 85082 30754 42545 99376 91704 19777 80085 36273 09417 10163 43490 76964 23722 29435 23661 25572 50881 47792 23151 97477 80605 69672 53801 71807 76360 34624 59278 77846 58506 56050 78084 42115 29697 52189 08740 19660 90665 18035 16501 79250 46195 01366 58543 66327 12549 63990 85491 44200 01457 47608 19302 21206 60243 30096 41270 48943 90397 17719 51806 99086 99860 66365 83232 27870 93765 02260 14929 10115 17177 63594 46020 23249 30028 04018 67723 91028 80978 66605 65118 32600 43688 50881 71572 38669 84224 22010 24950 55188 16948 03221 00251 54264 94639 81287 36776 58927 68816 35983 12477 88652 01411 74110 91360 11649 95076 62907 79436 46005 85194 19985 60162 64790 76153 21038 72755 71269 92518 27568 79893 02761 76114 61625 49356 49590 37980 45838 18232 33686 12016 24373 65698 46703 78585 33052 75833 33793 99075 21660 69238 05336 98879 56513 72855 93883 49989 47074 16181 55012 53970 64648 17194 67083 48197 21448 88987 90676 50379 59036 69672 49499 25452 79033 72963 61626 58976 03949 85767 41397 35944 10237 44329 70935 54779 82629 61459 14429 36451 42861 71585 87339 74679 18975 71211 95618 73857 83644 75844 84235 55581 05002 56114 92391 51889 30994 63428 41393 60803 83091 66281 88115 03715 28496 70597 41625 62823 60921 68075 15017 77253 87402 56425 34708 79089 13729 17228 28611 51591 56837 25241 63077 22544 06337 87593 10598 26760 94420 32619 24285 31701 87817 72960 23541 30606 72136 04600 03896 61093 64709 51414 17185 77701 41806 06443 63681 54644 40053 31608 77831 43174 44081 19494 22975 59931 40118 88683 31483 28027 06553 83300 46932 90115 74414 75631 39997 22170 38046 17092 89457 90962 71662 26074 07187 49975 35921 27560 84414 73782 33032 70330 16823 71936 48002 17328 57349 35947 56433 41299 43024 85023 57322 14597 84328 26414 21684 87872 16733 67010 61509 42434 56984 40187 33128 10107 94512 72237 37886 12605 81656 68053 71439 61278 88732 52737 38903 92890 50686 53241 38062 79602 59303 87727 69778 37928 68409 32536 58807 33988 45721 87460 21005 31148 33513 23850 04782 71693 76218 00490 47955 97959 29059 16554 70505 77751 43081 75112 69898 51884 08718 56402 60353 05583 73783 24229 24185 62564 42550 22672 15598 02740 12617 97192 80471 39600 68916 38286 65277 00975 27670 69777 03643 92602 24372 84184 08832 51848 77047 26384 40379 53016 69054 65937 46161 93238 40363 89313 13643 27137 68884 10268 11219 89127 52230 56256 75625 47017 25086 34976 53672 88605 96675 27408 68627 40791 28565 76996 31378 97530 34660 61666 98042 18267 72456 05306 60773 89962 42183 40859 88207 18646 82623 21508 02882 86359 74683 96543 58856 68550 37731 31296 58797 58105 01214 91620 76567 69950 65971 53447 63470 32085 32156 03674 82860 83786 56803 07306 26576 33469 77429 56346 43716 70939 71930 60876 96349 53288 46833 61303 88294 31040 80029 68738 69117 06666 61468 00015 12114 34422 56023 87447 43252 50769 38707 77751 93299 94213 72772 11258 84360 87158 34835 62696 16619 80572 52661 22067 97540 62106 20806 49882 91845 43953 01529 98209 25030 05498 25704 33905 53570 16865 31205 26495 61485 72492 57386 20691 74036 95213 53373 25316 66345 46658 85972 86659 45113 64413 70331 39367 21185 69553 95210 84584 07244 32383 55860 63106 80696 49248 51232 63269 95146 03596 03729 72531 98368 42336 39046 32136 71011 61928 21711 15028 28016 04488 05880 23820 31981 49309 63695 96735 83274 20249 88245 68494 12738 60566 49135 25267 06046 23445 05492 27581 15170 93149 21879 59271 80019 40968 86698 68370 37302 20047 53143 38181 09270 80300 17205 93553 05207 00706 07223 39994 63990 57131 15870 99635 77735 90271 96285 06114 65148 37526 20956 53467 13290 02599 43976 63114 54590 26858 98979 11583 70934 19370 44115 51219 20117 16488 05669 45938 13118 38437 65620 62784 63104 90346 29395 00294 58341 16482 41149 69758 32601 18007 31699 43739 35069 66295 71241 02732 39138 74175 49230 71862 45454 32220 39552 73529 52402 45903 80574 45028 92246 88628 53365 42213 81572 21311 63288 11205 21464 89805 18009 20247 19391 71055 53901 13943 31668 15158 28843 68760 69611 02505 17100 73927 62385 55338 62725 53538 83096 06716 44662 37092 26468 09671 25406 18695 02143 17621 16681 40097 59528 14939 07222 60111 26811 53108 38731 76173 23235 26360 58381 73151 03459 57365 38223 53499 29358 22836 85100 78108 84634 34998 35184 04451 70427 01893 81994 24341 00905 75376 25776 75711 18090 08816 41833 19201 96262 34162 88166 52137 47173 25477 72778 34887 74366 51882 87521 56685 71950 63719 36565 39038 94493 66421 76400 31215 27870 22236 64636 35755 50356 55769 48886 54950 02708 53923 61710 55021 31147 41374 41061 34445 54419 21013 36172 99628 56948 99193 36918 47294 78580 72915 60885 10396 78195 94298 33186 48075 60836 79551 49663 64489 65592 94818 78517 84038 77332 62470 51945 05041 98477 42014 18394 77312 02815 88684 57072 90544 05751 06012 85258 05659 47030 46836 34459 26525 52137 00806 87520 09593 45360 73162 26118 72817 39280 74623 09468 53678 23106 09792 15993 60019 94623 79934 34210 68781 34973 46959 24646 97525 06246 95861 69091 78573 97659 51993 92993 99556 75427 14654 91045 68607 02099 01260 68187 04984 17807 91739 24071 94599 63230 60254 70790 17745 27513 18680 99822 84730 86076 65368 66855 51646 77029 11336 82756 31072 23346 72611 37054 90795 36583 45386 37196 23585 63126 18387 15677 41187 38527 72292 25947 43373 78569 55384 56246 80101 39057 27871 01651 29666 36764 45187 24656 53730 40244 36841 40814 48873 29578 47348 49000 30194 77888 02046 03246 60842 87535 18483 64959 19508 28883 23206 52212 81041 90448 04724 79492 91342 28495 19700 22601 31043 00624 10717 97150 27934 33263 40799 59605 31446 05323 04885 28972 91765 98760 16667 81193 79323 72453 85720 96075 82277 17848 33616 13582 61289 62261 18129 45592 74627 67137 79448 75867 53657 54486 14076 11931 12595 85126 55759 73457 30153 33642 63076 79854 43385 76171 53334 62325 27057 20053 03988 28949 90342 59566 23297 57824 88735 02925 91668 25894 45689 46559 92658 45476 26945 28780 51650 17206 74785 41788 79822 76806 53665 06419 10973 43452 88783 38621 72615 62695 82654 47820 56729 87756 42632 53215 94294 41803 99432 17000 09054 26507 63095 58846 58951 71709 14760 74371 36893 31946 90909 81904 50129 03070 99566 22662 03031 82649 36573 36984 19555 77696 37876 24918 85286 56866 07600 56602 56054 45711 33728 68402 05574 41603 08370 52312 24258 72234 38854 12317 94813 88550 07568 93811 24935 38631 86352 87083 79984 56926 19981 79452 33640 87429 59118 07474 53419 55142 03517 26184 20084 55091 70845 68236 82008 97739 45584 26792 14273 47756 08796 44279 20270 83121 50156 40634 13416 17166 44806 98154 83764 49157 39001 21217 04154 78725 91998 94382 53649 50514 77137 93991 47205 21952 90793 96137 62110 72384 94290 61635 76045 96231 25350 60685 37651 42311 53496 65683 71511 66042 20796 39446 66211 63255 15772 90709 78473 15627 82775 98788 13649 19512 57483 32879 37715 71459 09106 48416 42678 30994 97236 74420 17586 22694 02159 40792 44805 41255 36043 13179 92696 73915 75424 19296 60731 23937 63542 13923 06178 76753 95871 14361 04089 40996 60894 71418 34069 83629 93675 36262 15452 47298 46421 37528 91079 88438 13060 95552 62272 08375 18629 83706 67872 24430 19579 37937 86072 10725 42772 89071 73285 48743 74355 78196 65117 16618 33088 11291 20245 20404 86822 00072 34403 50254 48202 83425 41878 84653 60259 15064 45271 65770 00445 21097 73558 58976 22655 48494 16217 14989 53238 34216 00114 06295 07184 90427 78925 85527 43035 22139 68356 79018 07640 60421 38307 30877 44601 70842 68827 22611 77180 84266 43336 51780 00217 19034 49234 26426 62922 61456 00433 73838 68335 55534 34530 04264 81847 39892 15627 08609 56506 29340 40526 49432 44261 44566 59212 91225 64889 35696 55009 15430 64261 34252 66847 25949 14314 23939 88454 32486 32746 18428 46655 98533 23122 10466 25989 01417 12103 44608 42716 16619 00125 71958 70793 21756 96985 44013 39762 20967 49454 18540 71184 46433 94699 01626 98351 60784 89245 14058 94094 63952 67807 35457 97003 07051 16368 25194 87701 18976 40028 27648 41416 05872 06184 18529 71891 54019 68825 32893 09149 66534 57535 71427 31848 20163 84644 83249 90378 86069 00807 27093 27673 12758 19665 63941 14896 17168 32980 45513 97295 06687 60474 09154 20428 42999 35410 25829 11350 22416 90769 43166 85742 42522 50902 69390 34814 85645 13030 69925 19959 04363 84028 42926 74125 73422 44776 55841 77886 17173 72654 62085 49829 44989 46787 35092 95816 52632 07225 89923 68768 45701 78230 38096 56788 31122 89305 80914 05726 10865 88484 58731 01658 15116 75333 27674 88701 48291 67419 70151 25597 82572 70740 64318 08601 42814 90241 46780 47232 75976 84269 63393 57735 42930 18673 94397 16388 61176 42090 04068 66339 88568 41681 00387 23892 14483 17607 01166 84503 88721 23643 67043 31409 11557 33280 18297 79887 36590 91665 96124 02021 77855 88548 76176 16198 93707 94380 05666 33648 84365 08914 48055 71039 76521 46960 27662 58359 90519 87042 30017 94655 3679
/;

$digits.subst-mutate( /\s+/, &#39;&#39;, :g );

sub MAIN ( $places = 15 ) { # could constrain further
	my $fractional = substr $digits, 0, $places;
	put 2 + FatRat.new( +$fractional, 10**($fractional.chars) );
	}
</pre>




		</div> <!-- excerpt -->

		<span class="read_more"><a href="/2017/04/24/as-many-digits-as-you-like/">Read more...</a></span>
</div> <!-- post -->



    <!-- ----------------------------------------------------------- -->
	<div class="post">
		<h2 class="post_title excerpt_page"><a href="/2017/04/18/the-24-puzzle-in-perl-6-using-channels-and-promises/">The 24 Puzzle, in Perl 6, using Channels and Promises</a></h2>
		<div class="byline">
		<span class="author">brian</span> • <span class="date">April 18, 2017</span>
</div>

		<div class="excerpt">





<a href="http://blog.plover.com/math/24-puzzle.html">Mark Jason Dominus solved the 24 Puzzle in Perl</a>, then explicated some non-Perl solutions other people sent him. <a href="https://rjbs.manxome.org/rubric/entry/2102">RJBS tried it in Forth</a>. I&#39;ve been meaning to try it in Perl 6. I bumbled around as I stubbornly tried to include language features I didn&#39;t really need, but that&#39;s part of the fun. <!--more-->

<a href="http://blog.plover.com/math/17-puzzle.html">Here&#39;s the problem</a>:

<blockquote>
Given 6,6,5,2, make 17 using the operators +, -, *, and /.
</blockquote>

The trick with these puzzles is to not read mjd&#39;s solution before struggling with it yourself. Also, I wanted to do this with Perl 6 features that I wouldn&#39;t be able to use in Perl or C. If the program looks the same in a different language, who cares? It&#39;s done. A mere translation is not that interesting.

I started with the idea that I wanted to use the cross and hyper operations to make the lists of things I&#39;d want to process, and I wanted to use a <a href="https://docs.perl6.org/type/Channel">Channel</a> to hold the list of candidate solutions that various <a href="https://docs.perl6.org/type/Promise">Promises</a> would try to solve. Something would fill the channel, and a set of promises running in other threads would grab candidates. Perl 6 has asynchronous support builtin and I wanted to play with that.

I want my program&#39;s invocation to take a list of numbers where the last number was the goal:

<pre class="brush:plain">
$ perl6 24-problems.p6 [digits] [goal]
</pre>

To solve this problem, I&#39;d run it as:

<pre class="brush:plain">
$ perl6 24-problems.p6 6 6 5 2 17
</pre>

Here&#39;s my solution, which is still a bit messy. For any list of <i>N</i> digits, I need <i>N - 1</i> operators to insert between the digits. I use the <a href="https://docs.perl6.org/language/operators#infix_X">cross operator</a> in the <a href="https://docs.perl6.org/language/operators#Reduction_Operators">reduction operator</a>, <code>[X]</code>, with a list of <i>N - 1</i> copies of <code>@operations</code>. That <code>xx</code> operator is the <a href="https://docs.perl6.org/routine/xx">list replication operator</a>. That&#39;s a lot of work for a single statement (and isn&#39;t that great?).

Ignore the middle of <code>MAIN</code> for a moment. In that <code>for</code> loop I cross all the permutations of digits with all the combinations of the operators. These are all of the candidate solutions. I end up with a bunch of two element lists; the first element is the digits in some order and the second is the list of operators. Perl 6 maintains that structure, so I send a two element thing into the channel.

Now, back up. I have another <code>for</code> that creates a bunch of promises with <a href="https://docs.perl6.org/routine/start"><code>start</code>. These will run in separate threads in the background. The <a href="https://docs.perl6.org/language/concurrency#index-entry-whenever"><code>whenever</code></a> in <code>react</code> grabs an item from the channel and does some work. An item in a channel is guaranteed to be handled only once so the promises do their work then fight it out to get another candidate to try.

So, this has the Perl 6 structure I want:

<pre class="brush:plain">
sub MAIN (*@) {
	my $goal       = @*ARGS.pop;
	my @numbers    = @*ARGS.clone.flat;
	my @operations = <+ * -></+>;

	# I need N - 1 operators, with repeats (so, + + + is fine)
	my @cross = [X] @operations xx (@numbers.elems - 1);
	my @perms = @numbers.permutations.unique( :with(&amp;[eqv]) );

	put &quot;Total candidates: &quot; ~ ( @cross.elems * @perms.elems );

	my $channel = Channel.new;

	my @p;
	my $total = 0;
	for 1 .. 1 {
		@p.push: start {
			react  {
				whenever $channel -&gt; $item {
					state $count = 0; $count++;
					my $result = evaluate( $item );
					put &quot;SOLUTION! $result[*-1] = $goal&quot; if $result[0] == $goal;
					LAST {
						$total += $count;
						put &quot;Thread {$*THREAD.id} handled $count candidates&quot;
						}
					}
				}
			};
		}

	my $start = now;
	put &quot;Starting to send to channels&quot;;
	for @perms X @cross -&gt; $i {
		$channel.send( $i )
		}
	put &quot;Done sending to channels: &quot; ~ (now - $start) ~ &quot; seconds&quot;;

	$channel.close;

	await |@p;

	put &quot;Total handled was $total&quot;;
	}

sub evaluate ( $item ) {
	my @digits  = $item[0].flat;
	my @ops     = $item[1].flat;

	my @ops2 = ( |@ops, &#39;&#39; );

	my $string = @digits &gt;&gt;~&lt;<@ops2; @ops.elems while> 0 {
		splice(
			@digits, 0, 2,
			op( @ops.shift, |@digits[0,1] )
			);
		}

	return [ @digits[0], $string ];
	}

multi op ( &#39;+&#39;, $m, $n ) { $m + $n }
multi op ( &#39;-&#39;, $m, $n ) { $m - $n }
multi op ( &#39;/&#39;, $m, $n ) { $m / $n }
multi op ( &#39;*&#39;, $m, $n ) { $m * $n }
</@ops2;></pre>

I struggled for a bit to figure out what I wanted to do in <code>evaluate</code>. For a long time I tried to force a situation where I&#39;d use the <a href="https://docs.perl6.org/routine/Z">zip meta operator</a>, <code>Z</code>, to merge the digits and the operators. If I could do that, I could stringify and EVAL that. Yeah, that&#39;s disgusting and requires a secret pragma, but I got stuck on that idea. The problem was the ugliness of operator list having one less item than the digits list. The <code>Z</code> wants to use the same number of elements from both sides and will cycle back to the beginning of the shorter list. For awhile I&#39;d mutate the operator list to add the empty string at the end. I never liked this and it made everything harder than it needed to be.

While I was goofing around with that, I had the idea that I could zip the lists myself. As long as there was something in <code>@ops</code>, take one item from that list and two items from <code>@digits</code> and push them onto a new array:

<pre class="brush:plain">
@temp-array.push: @digits[0], @ops[0], @digits[1];
</pre>

It took me much longer that it should have to realize that I didn&#39;t need the temporary array. I&#39;ll grab the same elements, figure out the result, and replace those two numbers with the single number I just computed. When <code>@ops</code> was empty, I should have the answer in <code>@digits</code>. Boom. But, I still did the zip thing to make a string that represented the operation so I know how I got it.

To compute the intermediate results I created some <code>multi</code> subs with similar signatures, but I used a literal string as the first thing in the signature. This is how I&#39;d translate the strings representing the operators into actual operations. I could have done the same thing with <code>given</code>, but I didn&#39;t:

<pre class="brush:plain">
my $result = do {
	given $o {
		when &#39;+&#39; { $m + $n }
		when &#39;-&#39; { $m - $n }
		when &#39;*&#39; { $m * $n }
		when &#39;/&#39; { $m / $n }
		}
	};
</pre>

When I run this, I get output like this:

<pre class="brush:plain">
Total candidates: 768
Starting to send to channels
SOLUTION! 5/ 6+ 2* 6 = 17
Done sending to channels: 1.5209437 seconds
Thread 13 handled 55 candidates
Thread 6 handled 57 candidates
Thread 3 handled 656 candidates
Total handled was 768
</pre>

<h2>A digression of threading</h2>

Notice that one of the threads handled many more candidates. This isn&#39;t true for every run. More often, all threads handle close to the same number of candidates. But, whenever that happened the program was much slower by about half a second. That probably means I&#39;m using too many threads. If I changed the code to create only one promise, it&#39;s very fast:

<pre class="brush:plain">
Total candidates: 768
Starting to send to channels
Done sending to channels: 0.24503289 seconds
SOLUTION! 5/ 6+ 2* 6 = 17
Thread 4 handled 768 candidates
Total handled was 768
</pre>

This sniffs of a synchronization problem. If threads compete for the same physical processor, they have to cooperate (and something has to help them do that). I wasn&#39;t concerned about making this fast because I wanted to play with the features, but its something to think about for production programming.

Here&#39;s the overall timing for three promises. Notice the user time is about two times the real time because multiple threads are working at the same time:

<pre class="brush:plain">
$ time perl6 pick-* 6 6 5 2 17
Total candidates: 768
Starting to send to channels
Done sending to channels: 2.0787578 seconds
Thread 6 handled 50 candidates
SOLUTION! 5/ 6+ 2* 6 = 17
Thread 4 handled 344 candidates
Thread 3 handled 374 candidates
Total handled was 768

real	0m3.294s
user	0m7.836s
sys	0m0.843s
</pre>

And for one promise, the user time and real time are about the same, and both are lower than using three threads:

<pre class="brush:plain">
$ time perl6 pick-* 6 6 5 2 17
Total candidates: 768
Starting to send to channels
Done sending to channels: 0.2340613 seconds
SOLUTION! 5/ 6+ 2* 6 = 17
Thread 4 handled 768 candidates
Total handled was 768

real	0m2.088s
user	0m2.148s
sys	0m0.276s
</pre>

If there&#39;s a lot of lag in the processing (like fetching a resource or waiting), slicing operations into threads can have them wait together. Since those threads don&#39;t need to use the processor to wait, they aren&#39;t competing and getting in each other&#39;s way.

Here&#39;s a stripped down version of my previous program where most of the processing of each item isn&#39;t actual work:

<pre class="brush:plain">
my $channel = Channel.new;

my $threads = @*ARGS[0] // 1;
put &quot;Using $threads threads&quot;;

my @promises;
for 0 ... ^$threads {
	@promises.push: start {
		react  {
			whenever $channel -&gt; $item {
				put &quot;Thread {$*THREAD.id} handing $item&quot;;
				sleep $item % 3
				}
			}
		};
	}

for ^37 {
	$channel.send( $_ )
	}

$channel.close;

await |@promises;
</pre>

With one thread, it takes about 37 seconds on the wallclock, but notice the user time is really low:

<pre class="brush:plain">
$ time perl6 wait.p6
Using 1 threads
Thread 3 handing 0
...
Thread 3 handing 34
Thread 3 handing 35
Thread 3 handing 36

real	0m36.359s
user	0m0.278s
sys	0m0.067s
</pre>

Three threads can sleep simultaneously and can be much faster. The user time is about the same, but the wallclock time is less than half what it was before:

<pre class="brush:plain">
$ time perl6 wait.p6 3
Using 3 threads
Thread 4 handing 0
Thread 3 handing 1
...
Thread 3 handing 33
Thread 3 handing 36

real	0m15.637s
user	0m0.281s
sys	0m0.112s
</pre>

<h3>A slight digression on EVAL</h3>

As part of my initial idea, I tried to create a string version of the solution and <code>EVAL</code> the whole thing. That&#39;s expedient if not prudent, but sometimes you want the answer any way you can get it and don&#39;t care about the purity or cleverness. I can easily make a list of all of the combinations of three operators (one less than the number of digits):

<pre>
$ perl6
&gt; my @a = &lt; + - / * &gt;

&gt; [X] @a xx 3
((+ + +) (+ + -) (+ + /) (+ + *) (+ - +) (+ - -) (+ - /) (+ - *) (+ / +) (+ / -) (+ / /) (+ / *) (+ * +) (+ * -) (+ * /) (+ * *) (- + +) (- + -) (- + /) (- + *) (- - +) (- - -) (- - /) (- - *) (- / +) (- / -) (- / /) (- / *) (- * +) (- * -) (- * /) (- * *) (/ + +) (/ + -) (/ + /) (/ + *) (/ - +) (/ - -) (/ - /) (/ - *) (/ / +) (/ / -) (/ / /) (/ / *) (/ * +) (/ * -) (/ * /) (/ * *) (* + +) (* + -) (* + /) (* + *) (* - +) (* - -) (* - /) (* - *) (* / +) (* / -) (* / /) (* / *) (* * +) (* * -) (* * /) (* * *))
</pre>

If I wanted to make a string like <code>6+6+5-2</code> with the <code>Z</code> operator, I&#39;d need something at the end to come after the <code>2</code>. It can&#39;t be another operator though. I wanted something like this:

<pre class="brush:plain">
my @digits = 6, 6, 5, 2;
my @ops    = <+ * -></+>;
my @perms  = @digits.permutations.unique( :with(&amp;[eqv]) );

my @cross = [X] @ops xx ( @digits.elems - 1 );

my @results = ( @perms X @cross )
	.map(  { my @d= (|.[1], &#39;&#39;); .[0] &gt;&gt;~&gt;&gt; @d } )
	.map(  { say &quot;$_ = &quot; ~ EVAL ~$_; $_  } )
	.grep( { 17 == EVAL $_ } )
</pre>

Even when I solved that, another problem came up. When I <code>EVAL</code> the statement, Perl 6 has a particular order of operations where the problem actually goes from left to right without precedence. That&#39;s not explicitly stated in the problem, but it&#39;s part of the problem. It took me a bit to figure out why I wasn&#39;t seeing any solutions this way.

Besides, I was trying to avoid the <a href="/2016/12/01/quick-tip-16-explosive-combinatorials/">combinatorial explosion</a> and the time to create the giant list only to go through it to tear it apart when I can do it in fewer steps.

I&#39;d later discover that although I&#39;d found a candidate for the the <code>6 6 5 2</code> situation, I hadn&#39;t actually solved the puzzle correctly. Besides the combinations of digits and operators, there was a third set of permutations. I needed all the orders of operations. But, let&#39;s think about Mark Jason&#39;s solution now.

<h3>Back to Mark Jason&#39;s solution</h3>

After I&#39;d figured out what I wanted to do, I looked back to see what Mark Jason had done. I won&#39;t re-explicate <a href="http://blog.plover.com/math/24-puzzle.html">his approach</a>, but I do want to see how similar we were.

He also used a queue. I had mine in a channel and he maintained a list. I&#39;d say that was about the same idea with different phenotypes.

He created a way to process two numbers at a time and replace them with their result. His added to a history string each time whereas I made the history string ahead of time. His solution was different because each combination of digits and operators represented a tree of solutions. You can do the first pair of digits first, or the last pair first, or the middle pair first. Then, you go through that for what&#39;s left. I&#39;d accidentally found a solution to the particular digits because those worked in left to right order. But, I couldn&#39;t find a solution to <code>8 8 3 3 == 24</code> because there isn&#39;t one that evaluates left to right. I hadn&#39;t handled the situation where I do the operations in other orders, like this:

<pre class="brush:plain">
8 ÷ (3 - (8÷3)) = 24
</pre>

There are actually six paths through the possible combinations of four digits and three operators. There were various ways that I could handle this. I could make all of those candidates and add them to the channel, or I could have the thing that takes the existing candidates generate sub problems and add those to the channel. This would mess up my tidy and apparently unclever solution to getting the history.

And, here&#39;s a good place to back up for a moment. Had I thought about this problem more and paid attention to his note about <code>8 8 3 3 == 24</code>, I would have made a test case for that and noticed I couldn&#39;t solve it. I do that when I&#39;m doing production programming and am very careful about the specification, but I wasn&#39;t fastidious here. I think my hubris got in the way. However, I did notice my omission as I was double-checking my work. It&#39;s a bit heart stopping to realize such a thing right before you were about to push to master though. ;)

After playing with this much longer than I should have, I came up with something close to what Mark Jason did. I took longer because I was trying quite hard to avoid his solution and I was trying to be clever in Perl 6. He created nodes for each computation (with the starting trivial case of the result being the starting digit). As he carried those along, he combined two nodes to create a new node with the new result but also a new string version of the combined history of those two nodes. While I was trying to avoid this, I was doing the same idea with a differen&#39;t implementation. I didn&#39;t have a fresh idea (other that creating an RPN calculator class, until I realized that it was still the same idea).

I&#39;ve adjusted a few things from my previous program and explained some
of the trickier accounting to get the history. There&#39;s plenty more I don&#39;t like about my implementation, but it&#39;s good enough that I can move on to other problems:

<pre class="brush:plain">
sub MAIN (*@) {
	my $goal       = @*ARGS.pop;
	my @numbers    = @*ARGS.clone.flat;
	my @operations = <+ * -></+>;

	my @cross = [X] @operations xx (@numbers.elems - 1);
	my @perms = @numbers.permutations.unique( :with(&amp;[eqv]) );
	my @orders = ( 0 .. (@numbers.elems - 2) ).permutations;

	put &quot;Total candidates: &quot; ~
		( @cross.elems * @perms.elems * @orders.elems );

	my $channel = Channel.new;

	my @promises;
	my $total = 0;
	#`(
		probably need to make fewer threads since this is
		computation heavy, but here&#39;s where you can adjust
		that.
		)
	my $max_promises = 1;  # 1 seems to be the right number
	for 1 ..  $max_promises {
		@promises.push: start {
			react  {
				whenever $channel -&gt; $item {
					state $count = 0; $count++;
					my $result = evaluate( $item );
					next unless defined $result[0];
					put &quot;SOLUTION! $result[1] = $goal&quot;
						if $result[0] == $goal;
					}
				}
			};
		}

	my $start = now;
	put &quot;Starting to send to channels&quot;;
	#`(
		Don&#39;t really need the double X here, but it saves a
		hardcoded series of next loops. With 4 digits, the
		maximum list size is under 10,000. The nested loop
		version ran in about the same time
		)
	for @perms X @cross X @orders -&gt; $i {
		$channel.send( $i )
		}
	put &quot;Done sending to channels: &quot;
		~ (now - $start) ~ &quot; seconds&quot;;

	$channel.close;

	await |@promises;

	put &quot;Total handled was $total&quot;;
	}

sub evaluate ( $item ) {
	#`(
		Each entry in digits is a tuple that represents a
		sub computation. The first item in there is a number
		and the second is a string that represents the
		history of the prior computations. At the start, the
		history is simply the digit for that tuple
		)
	my @digits  = |$item[0].map: { [ $_, $_ ] };
	#`(
		Ops is a list of mathematical operators, and should
		have one fewer elements that @digits since every
		operator needs two operands
		)
	my @ops     = |$item[1];
	#`(
		The orders represents the order of operations. Think
		of this as implementing implied parens around
		operations. With this, you aren&#39;t stuck with issues
		of precedence or left-to-right evaluation.
		)
	my @orders  = |$item[2];
	#`(
		@orders_offset tracks and adjusts positions in the
		operation. It&#39;s important with you want to do the
		3rd operation last, for instance, but doing the 1st
		and 2nd operations has removed elements from
		@digits. Later operations need to adjust their
		offsets when they look for operands in @digits.

		The indices in @orders_offset correspond to the
		values @orders. Use the value from @orders as the
		index into @orders_offset to get the offset.
		)
	my @orders_offset = 0 xx @orders.elems;


	#`(
		Go through all the values in @orders, which
		correspond to the index to look up the operation in
		@ops and the index for the offsets in @digits (which
		reduces as we do work).
		)

	for ^@orders {
		my ( $real_order ) = @orders[$_];
		my ( $order )      = $real_order -
			@orders_offset[$real_order];
		my ( $op )         = @ops[$real_order];

		my $result = op( $op, @digits[$order], @digits[$order+1] );
		return [ NaN, Str ] unless defined $result;

		my $string =
			&quot;({@digits[$order][1]} $op {@digits[$order+1][1]})&quot;;

		# splice is slurpy, so do extra work to maintain the tuple
		@digits.splice: $order, 2, [ $[ $result, $string ] ];

		#`(
			if this step combined elements, adjust offsets for
			later operations. That is, when the list shrinks,
			increase offsets after that point so the offsets
			still refer to the same items.
			)
		for ^@orders_offset {@orders_offset[$_]++ if $order &lt; $_ }
		}

	return @digits[0];
	}

# all of these get a tuple from @digits
multi op ( &#39;+&#39;, $m, $n ) { $m[0] + $n[0] }
multi op ( &#39;-&#39;, $m, $n ) { $m[0] - $n[0] }
multi op ( &#39;/&#39;, $m, $n ) { $n[0] == 0 ?? fail() !! $m[0] / $n[0] }
multi op ( &#39;*&#39;, $m, $n ) { $m[0] * $n[0] }
</pre>



</a>
		</div> <!-- excerpt -->

		<span class="read_more"><a href="/2017/04/18/the-24-puzzle-in-perl-6-using-channels-and-promises/">Read more...</a></span>
</div> <!-- post -->



    <!-- ----------------------------------------------------------- -->
	<div class="post">
		<h2 class="post_title excerpt_page"><a href="/2017/04/16/quick-trick-longest-string-using-the-reduction-operator/">Quick Trick: Longest string using the reduction operator</a></h2>
		<div class="byline">
		<span class="author">brian</span> • <span class="date">April 16, 2017</span>
</div>

		<div class="excerpt">





I had a problem where I wanted the longest string from a list. I didn&#39;t want to sort because I wanted to do it with a single pass. (The comments show sorting through <code>max</code>, which I was also avoiding). <!--more-->

<pre class="brush:plain">
# quote words, but with quote protection!
my @strings = qww/
	&quot;This is a line&quot;
	short
	&quot;A very very long string maybe, certainly the longest&quot;
	other
	not
	this
	a
	one
	or
	even
	1
	/;

# If you give one thing to sort, it does that to both things and
# compares with camp
my ($longest) = @strings.sort( *.chars ).[*-1];
</pre>

Instead, I decided to use the <a href="https://docs.perl6.org/language/operators#Reduction_Operators">reduction operator</a> with an operator that I make up (and limit to the lexical scope). The infix <code>longest</code> takes two strings and returns the longest. I let the reduction take care of the rest:

<pre class="brush:plain">
my sub infix:<longest> { $^a.chars &gt; $^b.chars ?? $^a !! $^b }
my $longest = [longest] @strings;

say &quot;Longest is ｢$longest｣&quot;;
</longest></pre>

Some commenters point out that calling <code>.max</code> does the same thing. Looking in the <a href="https://github.com/rakudo/rakudo/blob/8bf67298c7bac51790e924efc125e4f8f7600013/src/core/Any-iterable-methods.pm">Rakudo source for max, you see that it&#39;s single pass too:

<pre class="brush:plain">
my $longest = @strings.max: *.chars;
say &quot;Longest is ｢$longest｣&quot;;
</pre>


</a>
		</div> <!-- excerpt -->

		<span class="read_more"><a href="/2017/04/16/quick-trick-longest-string-using-the-reduction-operator/">Read more...</a></span>
</div> <!-- post -->






</div>
<!-- end excerpt_list -->

</div>
<!-- end middle_main_page -->

</html>

